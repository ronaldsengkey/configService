https:
  port: 8443
  tls:
    {
      default:
        {
          cert: "ssl/server.crt",
          key: "ssl/server.key",
          ca: ["ssl/rootCA.pem"],
        },
    }
  # options: { requestCert: true, rejectUnauthorized: true }
admin:
  port: 8444
  host: "localhost"
apiEndpoints:
  wallet:
    host: "localhost"
    methods: "GET,POST,PUT"
    paths: ["/wallet/*", "/wallet"]
  config:
    host: "localhost"
    methods: "GET,POST,PUT"
    paths: "/config/*"
  authentications:
    host: "localhost"
    methods: "GET,POST,PUT"
    paths: "/authentications/*"
  outlet:
    host: "localhost"
    methods: "GET,POST,PUT"
    paths: "/outlet/*"
  account:
    host: "localhost"
    methods: "GET,POST,PUT"
    paths: "/account/*"
  backend:
    host: "localhost"
    methods: "GET,POST,PUT"
    paths: "/backend/*"
  transaction:
    host: "localhost"
    methods: "GET,POST,PUT"
    paths: "/transaction/*"
  paymentGateway:
    host: "localhost"
    methods: "GET,POST,PUT"
    paths: "/paymentGateway/*"
serviceEndpoints:
  wallet:
    url: "http://localhost:8089"
  config:
    url: "http://localhost:8442"
  authentications:
    url: "http://localhost:8202"
  outlet:
    url: "http://localhost:8205"
  account:
    url: "http://localhost:8206"
  backend:
    url: "http://localhost:8203"
  transaction:
    url: "http://localhost:8201"
  paymentGateway:
    url: "http://localhost:8200"
  httpbin:
    url: "https://httpbin.org"
policies:
  - jwt
  - basic-auth
  - cors
  - expression
  - key-auth
  - log
  - oauth2
  - proxy
  - rate-limit
pipelines:
  default:
    apiEndpoints:
      - api
    policies:
      # Uncomment `key-auth:` when instructed to in the Getting Started guide.
      - key-auth:
      # - oauth2:
      - proxy:
          - action:
              serviceEndpoint: httpbin
              changeOrigin: true
  wallet:
    apiEndpoints:
      - wallet
    policies:
      - rate-limit:
          - action:
              max: 5
              windowMs: 120000
      - proxy:
          - action:
              serviceEndpoint: wallet
              changeOrigin: true

  paymentGateway:
    apiEndpoints:
      - paymentGateway
    policies:
      - rate-limit:
          - action:
              max: 5
              windowMs: 120000
      - proxy:
          - action:
              serviceEndpoint: paymentGateway
              changeOrigin: true

  config:
    apiEndpoints:
      - config
    policies:
      - rate-limit:
          - action:
              max: 5
              windowMs: 120000
      - proxy:
          - action:
              serviceEndpoint: config
              changeOrigin: true

  authentications:
    apiEndpoints:
      - authentications
    policies:
      - rate-limit:
          - action:
              max: 5
              windowMs: 120000
      - key-auth:
      - proxy:
          - action:
              serviceEndpoint: authentications
              changeOrigin: true

  outlet:
    apiEndpoints:
      - outlet
    policies:
      - rate-limit:
          - action:
              max: 5
              windowMs: 120000
      - key-auth:
      - proxy:
          - action:
              serviceEndpoint: outlet
              changeOrigin: true

  account:
    apiEndpoints:
      - account
    policies:
      - rate-limit:
          - action:
              max: 5
              windowMs: 120000
      # - key-auth:
      - proxy:
          - action:
              serviceEndpoint: account
              changeOrigin: true
  backend:
    apiEndpoints:
      - backend
    policies:
      - rate-limit:
          - action:
              max: 5
              windowMs: 120000
      - key-auth:
          - action:
              apiKeyHeader: "authorization"
              apiKeyHeaderScheme: "apiKey"
      # - jwt:
      #   - action:
      #       secretOrPublicKeyFile: ./key/pubKey.pem
      #       checkCredentialExistence: false
      - proxy:
          - action:
              serviceEndpoint: backend
              changeOrigin: true

  transaction:
    apiEndpoints:
      - transaction
    policies:
      - rate-limit:
          - action:
              max: 5
              windowMs: 120000
      - key-auth:
      - proxy:
          - action:
              serviceEndpoint: transaction
              changeOrigin: true
